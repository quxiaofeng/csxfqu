---
layout: post
tags: [coding, image processing, gui]
titile: Qt and OpenCV ENV Settings
description: Qt and OpenCV setting for image processing and demo software design
---

## OpenCV Static

> **[Example Project](https://github.com/quxiaofeng/static_qt_opencv_app)**

The static OpenCV requires the qt static, and it can not be compiled without static qt lib.

### Download these files

1. [CMake 2.8](http://cmake.org/cmake/resources/software.html)
2. [OpenCV 2.4.2](http://sourceforge.net/projects/opencvlibrary/files/latest/download)
3. [QT SDK 1.2.1](http://www.developer.nokia.com/Develop/Qt/Tools/)

### Compiling Steps

1. With preinstalled Visual Studio 2010
2. install QT SDK and update
3. unpack OpenCV-2.4.2.exe
4. configure opencv with cmake    
Configure at least three times. First time for opencv options, second for the QT, third time finish all.    
   + Visual Studio 10(for msvc2010 x86 platform)
   + Check debug_info for Debug version
   + Check with_qt to add Qt support
   + QT_QMAKE_EXECUTABLE: QtSDK/Desktop/Qt/4.8.1/msvc2010/bin/qmake.exe for msvc 2010 qt
   + Check with_videoinput to add DirectShow support
   + Uncheck shared_libs to build static lib
   + Uncheck build_with_static_crt, because Qt links it dynamically. Maybe check when Qt is static compiled
   + Uncheck with_ffmpeg to avoid the opencv_ffmpeg.dll
   + Uncheck these to save time: docs/examples/package/perf_tests/tests
5. Then generate
6. Open /output/path/OpenCV.sln with Visual Studio 2010
   + select Debug/Release Win32 config
   + Build "ALL_BUILD" and wait for several minutes.
   + Build "CMakeTargets/INSTALL" and wait for several seconds

### The output

      output/path/install
                     bin/*.dll
                     include/*
                     lib/*
                     share/*

### Excute this Ruby Sript

> *tidy.rb*

      require 'fileutils'

      FileUtils.mv(Dir.glob('share/OpenCV/3rdparty/lib/*.lib'), 'lib/')
      FileUtils.rm_rf('share/')
      FileUtils.rm_rf('doc/')
      FileUtils.rm(Dir.glob('bin/*.exe'), :force=>true)
      FileUtils.rm(Dir.glob('*.cmake'), :force=>true)
      FileUtils.rm(Dir.glob('*~'), :force=>true)

      system("7z a static_opencv_lib.7z lib include")

#### dependencies of tidy.rb: Ruby, DevKit, fileutils


### Then use this config in Qt pro file

*Suppose the opencv static lib is placed in "../opencv_static_lib" folder*

      win32 {
          OPENCVDIR = "../opencv_static_lib"
          exists($$OPENCVDIR) {
              DEFINES += USEOPENCV
              INCLUDEPATH += \
                  $${OPENCVDIR}/include
              DEPENDPATH += \
                  $${OPENCVDIR}/include
              CONFIG(release, debug|release) {
                  LIBS += -L$${OPENCVDIR}/lib \
                      -llibjasper \
                      -llibjpeg \
                      -llibpng \
                      -llibtiff \
                      -lopencv_calib3d242 \
                      -lopencv_contrib242 \
                      -lopencv_core242 \
                      -lopencv_features2d242 \
                      -lopencv_flann242 \
                      -lopencv_gpu242 \
                      -lopencv_highgui242 \
                      -lopencv_imgproc242 \
                      -lopencv_legacy242 \
                      -lopencv_ml242 \
                      -lopencv_nonfree242 \
                      -lopencv_objdetect242 \
                      -lopencv_photo242 \
                      -lopencv_stitching242 \
                      -lopencv_ts242 \
                      -lopencv_video242 \
                      -lopencv_videostab242 \
                      -lzlib
                  PRE_TARGETDEPS += \
                      $${OPENCVDIR}/lib/libjasper.lib \
                      $${OPENCVDIR}/lib/libjpeg.lib \
                      $${OPENCVDIR}/lib/libpng.lib \
                      $${OPENCVDIR}/lib/libtiff.lib \
                      $${OPENCVDIR}/lib/opencv_calib3d242.lib \
                      $${OPENCVDIR}/lib/opencv_contrib242.lib \
                      $${OPENCVDIR}/lib/opencv_core242.lib \
                      $${OPENCVDIR}/lib/opencv_features2d242.lib \
                      $${OPENCVDIR}/lib/opencv_flann242.lib \
                      $${OPENCVDIR}/lib/opencv_gpu242.lib \
                      $${OPENCVDIR}/lib/opencv_highgui242.lib \
                      $${OPENCVDIR}/lib/opencv_imgproc242.lib \
                      $${OPENCVDIR}/lib/opencv_legacy242.lib \
                      $${OPENCVDIR}/lib/opencv_ml242.lib \
                      $${OPENCVDIR}/lib/opencv_nonfree242.lib \
                      $${OPENCVDIR}/lib/opencv_objdetect242.lib \
                      $${OPENCVDIR}/lib/opencv_photo242.lib \
                      $${OPENCVDIR}/lib/opencv_stitching242.lib \
                      $${OPENCVDIR}/lib/opencv_ts242.lib \
                      $${OPENCVDIR}/lib/opencv_video242.lib \
                      $${OPENCVDIR}/lib/opencv_videostab242.lib \
                      $${OPENCVDIR}/lib/zlib.lib
              } else {
                  LIBS += -L$${OPENCVDIR}/lib \
                      -llibjasperd \
                      -llibjpegd \
                      -llibpngd \
                      -llibtiffd \
                      -lopencv_calib3d242d \
                      -lopencv_contrib242d \
                      -lopencv_core242d \
                      -lopencv_features2d242d \
                      -lopencv_flann242d \
                      -lopencv_gpu242d \
                      -lopencv_highgui242d \
                      -lopencv_imgproc242d \
                      -lopencv_legacy242d \
                      -lopencv_ml242d \
                      -lopencv_nonfree242d \
                      -lopencv_objdetect242d \
                      -lopencv_photo242d \
                      -lopencv_stitching242d \
                      -lopencv_ts242d \
                      -lopencv_video242d \
                      -lopencv_videostab242d \
                      -lzlibd
                  PRE_TARGETDEPS += \
                      $${OPENCVDIR}/lib/libjasperd.lib \
                      $${OPENCVDIR}/lib/libjpegd.lib \
                      $${OPENCVDIR}/lib/libpngd.lib \
                      $${OPENCVDIR}/lib/libtiffd.lib \
                      $${OPENCVDIR}/lib/opencv_calib3d242d.lib \
                      $${OPENCVDIR}/lib/opencv_contrib242d.lib \
                      $${OPENCVDIR}/lib/opencv_core242d.lib \
                      $${OPENCVDIR}/lib/opencv_features2d242d.lib \
                      $${OPENCVDIR}/lib/opencv_flann242d.lib \
                      $${OPENCVDIR}/lib/opencv_gpu242d.lib \
                      $${OPENCVDIR}/lib/opencv_highgui242d.lib \
                      $${OPENCVDIR}/lib/opencv_imgproc242d.lib \
                      $${OPENCVDIR}/lib/opencv_legacy242d.lib \
                      $${OPENCVDIR}/lib/opencv_ml242d.lib \
                      $${OPENCVDIR}/lib/opencv_nonfree242d.lib \
                      $${OPENCVDIR}/lib/opencv_objdetect242d.lib \
                      $${OPENCVDIR}/lib/opencv_photo242d.lib \
                      $${OPENCVDIR}/lib/opencv_stitching242d.lib \
                      $${OPENCVDIR}/lib/opencv_ts242d.lib \
                      $${OPENCVDIR}/lib/opencv_video242d.lib \
                      $${OPENCVDIR}/lib/opencv_videostab242d.lib \
                      $${OPENCVDIR}/lib/zlibd.lib
              }
              message("OpenCV libraries found in $${OPENCVDIR}")
          } else {
              message("OpenCV libraries not found.")
          }
      }

*And add "QT += testlib" to pro file*


## OpenCV DLL

The opencv without qt support dll can not be run under qt.

1. Check BUILD_SHARED_LIBS
2. Check BUILD_WITH_DEBUG_INFO

## Qt Static

### Prepare

+ Downloand [qt opensource 4.8.3](http://qt-project.org/downloads)
+ Install Visual Studio 2010
+ Download and install [Perl(Strawberryperl)](http://strawberryperl.com/)

### Compile follow this [guide](http://www.formortals.com/build-qt-static-small-microsoft-intel-gcc-compiler/)
1. copy qt source to a new folder(here 4.8.3 to ramdisk for speed)
2. edit make flags
3. open Visual Studio Command Line Prompt in Start Menu/MS Visual Studio 2010/Visual Studio Tools/
4. Configure QT as follows
        configure   -release -opensource -static -no-ltcg -fast -no-exceptions -no-accessibility 
                    -no-stl -opengl desktop -no-openvg -platform win32-msvc2010 -graphicssystem opengl 
                    -qt-zlib -qt-libpng -qt-libmng -qt-libtiff -qt-libjpeg -dsp -vcproj 
                    -incredibuild-xge -plugin-manifests -qmake -process -no-rtti -mmx 
                    -3dnow -sse -sse2 -multimedia -audio-backend -no-webkit -no-script 
                    -no-declarative -no-directwrite -arch windows -no-native-gestures 
                    -mp -saveconfig win32-msvc2010-static-x230     
        'y' to accept the license    
        nmake    


## Qt x64

+ According to [this post](http://qt-project.org/wiki/How_to_build_64bit_Qt_for_windows), the x64 support is not ready.

## Qt Thread

+ [Thread Basics Chinese Translation](http://blog.csdn.net/dbzhang800/article/details/6554104), [Original Version](http://qt-project.org/doc/qt-4.8/thread-basics.html)


## CDB for Qt Debug

+ Follow [this guide](http://doc.qt.digia.com/qtcreator-2.4/creator-debugger-engines.html)
+ [Here](http://msdn.microsoft.com/en-us/windows/hardware/gg463009) is a collection of Windows Debugging tools
+ Windows 7 SDK web installer could be downloaded from [here](http://www.microsoft.com/en-us/download/details.aspx?id=8279).
+ Windows 7 SDK ISOs [downloading page](http://www.microsoft.com/en-us/download/details.aspx?id=8442)
+ The configuration is like [this](http://stackoverflow.com/questions/9975949/how-to-configure-cdb-in-qt-creator).

# Qwt

+ [Source and Docs Online](http://qwt.sourceforge.net/index.html)
+ [A windows installing guide](http://johnhforrest.com/2010/09/installing-qwt-on-windows/)

# Other Docs and Online Resources

## OpenCV Doc Online

+ [Developer Site](http://code.opencv.org/projects/gsoc2012/wiki/Gsoc2012)
+ [Current Reference Site](http://docs.opencv.org/)
+ [OpenCV 2.3.2 Chinese Reference](http://www.opencv.org.cn/opencvdoc/2.3.2/html/index.html)

### OpenCV 2 Computer Vision Application Programming Cookbook
+ [Author's Website](http://www.laganiere.name/opencvCookbook/) including Errata, Code and Images

## Qt Source Online

+ [All Qt projcets source](http://qt.gitorious.org/)
+ [Qt lib git repo](http://qt.gitorious.org/qt/qt)

## Qt Designer

+ [Auto Resizing Layout](http://stackoverflow.com/questions/3492739/auto-expanding-layout-with-qt-designer)
